---
import AdminLayout from "../../../layouts/AdminLayout.astro";

// Handle Submit
if (Astro.request.method === "POST") {
    try {
        const formData = await Astro.request.formData();
        const data = {
            name: formData.get("name"),
            email: formData.get("email"),
            phone: formData.get("phone"),
            address: formData.get("address"),
        };

        // Kirim ke Backend
        await fetch("http://localhost:3000/api/customers", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
        });

        return Astro.redirect("/admin/customers");
    } catch (error) {
        console.error(error);
        // Tetap redirect biar gak stuck
        return Astro.redirect("/admin/customers");
    }
}
---

<AdminLayout title="Tambah Pelanggan">
    <div class="max-w-2xl bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-bold mb-4 text-gray-800">Tambah Pelanggan</h2>

        <form method="POST" class="space-y-4">
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2"
                    >Nama Lengkap</label>
                <input
                    type="text"
                    name="name"
                    required
                    class="w-full px-3 py-2 border rounded focus:outline-none focus:ring focus:ring-blue-300"/>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2"
                        >Email</label>
                    <input
                        type="email"
                        name="email"
                        required
                        class="w-full px-3 py-2 border rounded focus:outline-none focus:ring focus:ring-blue-300"/>
                </div>
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2"
                        >No. HP</label>
                    <input
                        type="text"
                        name="phone"
                        required
                        class="w-full px-3 py-2 border rounded focus:outline-none focus:ring focus:ring-blue-300"/>
                </div>
            </div>

            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2"
                    >Alamat</label>
                <textarea
                    name="address"
                    rows="3"
                    class="w-full px-3 py-2 border rounded focus:outline-none focus:ring focus:ring-blue-300">
                </textarea>
            </div>

            <div class="flex justify-end gap-2 pt-4">
                <a
                    href="/admin/customers"
                    class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
                    >Batal</a>
                <button
                    type="submit"
                    class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                    >Simpan</button>
            </div>
        </form>
    </div>
</AdminLayout>
