---
const { product } = Astro.props;

import { Image } from "astro:assets";
import tag from "../assets/rekomen.png";

// LOGIKA GAMBAR PINTAR (Supaya gambar dari Backend muncul)
// Jika ada gambar, cek apakah link lengkap (http) atau cuma nama file.
// Jika tidak ada gambar, pakai placeholder.
const imageUrl = product.image 
    ? (product.image.startsWith('http') ? product.image : `http://localhost:3000/uploads/${product.image}`)
    : "https://placehold.co/400x300?text=No+Image";

const idFavorit = [81, 2158, 2174, 2138, 104, 202, 1, 5]; 

// Cek apakah produk ini termasuk dalam daftar favorit?
const isRecommended = idFavorit.includes(product.id);
---

<a href={`/product?id=${product.id}`} 
   class="product-item group relative block w-full aspect-[3/4] rounded-3xl overflow-hidden shadow-md hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer"
   data-name={product.name.toLowerCase()}>

    <img 
        src={imageUrl} 
        alt={product.name} 
        class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
        onerror="this.src='https://placehold.co/400x500?text=Error'"
    />

    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-80 group-hover:opacity-90 transition-opacity"></div>

    <div class="absolute bottom-0 left-0 w-full p-5 translate-y-0 transition-transform duration-300">
        
        <h3 class="text-white text-xl font-bold leading-tight mb-2 drop-shadow-lg line-clamp-2">
            {product.name}
        </h3>

        <div class="flex justify-between items-end">
            <p class="text-yellow-400 text-lg font-extrabold tracking-wide drop-shadow-md">
                Rp {(product.price)}
            </p>

            {isRecommended && (
                <div>
                    <Image src={tag} alt="tag" class="h-8 w-auto" />
                </div>
            )}

            
        </div>
    </div>
</a>